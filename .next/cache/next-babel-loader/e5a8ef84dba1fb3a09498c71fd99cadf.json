{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n/* /lib/auth.js */\nimport { useEffect } from \"react\";\nimport Router from \"next/router\";\nimport Cookie from \"js-cookie\";\nimport axios from \"axios\";\nvar API_URL = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:1337\"; //register a new user\n\nexport var registerUser = function registerUser(username, email, password) {\n  //prevent function from being ran on the server\n  if (false) {\n    return;\n  }\n\n  return new Promise(function (resolve, reject) {\n    axios.post(\"\".concat(API_URL, \"/auth/local/register\"), {\n      username: username,\n      email: email,\n      password: password\n    }).then(function (res) {\n      /// Store the user information in local storage\n      window.localStorage.setItem(\"user\", JSON.stringify(res.data.user)); ///set token response from Strapi for server validation\n\n      Cookie.set(\"token\", res.data.jwt); ///resolve the promise to set loading to false in SignUp form\n\n      resolve(res); ///redirect back to home page for restaurance selection\n\n      setTimeout(function () {\n        Router.push(\"/\");\n        alert(\"Seccess!! Back to home page.\"); //easy mess\n      }, 1000);\n    })[\"catch\"](function (error) {\n      ///reject the promise and pass the error object back to the form\n      reject(error);\n    });\n  });\n};\nexport var login = function login(identifier, password) {\n  ////prevent function from being ran on the server\n  if (false) {\n    return;\n  }\n\n  return new Promise(function (resolve, reject) {\n    axios.post(\"\".concat(API_URL, \"/auth/local/\"), {\n      identifier: identifier,\n      password: password\n    }).then(function (res) {\n      window.localStorage.setItem(\"user\", JSON.stringify(res.data.user)); ////set token response from Strapi for server validation\n\n      Cookie.set(\"token\", res.data.jwt); //resolve the promise to set loading to false in SignUp form\n\n      resolve(res);\n      setTimeout(function () {\n        ///redirect back to home page for restaurance selection\n        Router.push(\"/\");\n        alert(\"Log In Seccess!\"); //easy mess\n      }, 1000);\n    })[\"catch\"](function (error) {\n      //reject the promise and pass the error object back to the form\n      reject(error);\n    });\n  });\n};\nexport var logout = function logout() {\n  //remove token and user cookie\n  Cookie.remove(\"token\"); //delete window.__user;\n\n  window.localStorage.removeItem(\"user\"); //experimental \n  /// sync logout between multiple windows\n\n  window.localStorage.setItem(\"logout\", Date.now()); ////redirect to the home page\n\n  setTimeout(function () {\n    Router.push(\"/\");\n    alert(\"Seccess!! Back to home page.\"); //easy mess\n  });\n}; //Higher Order Component to wrap our pages and logout simultaneously logged in tabs\n// THIS IS NOT USED in the tutorial, only provided if you wanted to implement\n\nexport var withAuthSync = function withAuthSync(Component) {\n  var Wrapper = function Wrapper(props) {\n    var syncLogout = function syncLogout(event) {\n      if (event.key === \"logout\") {\n        Router.push(\"/login\");\n      }\n    };\n\n    useEffect(function () {\n      window.addEventListener(\"storage\", syncLogout);\n      return function () {\n        window.removeEventListener(\"storage\", syncLogout);\n        window.localStorage.removeItem(\"logout\");\n      };\n    }, []);\n    return __jsx(Component, props);\n  };\n\n  if (Component.getInitialProps) {\n    Wrapper.getInitialProps = Component.getInitialProps;\n  }\n\n  return Wrapper;\n}; //// Retrieve the user information from local storage\n\nexport var getUserFromLocalStorage = function getUserFromLocalStorage() {\n  if (false) {\n    return null;\n  }\n\n  var user = window.localStorage.getItem(\"user\");\n  var token = Cookie.get(\"token\");\n\n  if (user) {\n    var parsedUser = JSON.parse(user);\n    return _objectSpread(_objectSpread({}, parsedUser), {}, {\n      jwt: token\n    });\n  }\n\n  return null;\n};","map":null,"metadata":{},"sourceType":"module"}